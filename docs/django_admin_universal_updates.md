# Django Admin - Universal Registration Updates

## Date: November 1, 2025

## âœ… Changes Made to Django Admin

### 1. **Read-Only ID Fields** âœ…

The following fields are now **READ-ONLY** in Django admin:
- `id` - Primary key (auto-generated)
- `organization_id` - Auto-generated or inherited
- `branch_id` - Auto-generated or inherited
- `created_at` - Timestamp
- `updated_at` - Timestamp

**These fields cannot be edited** - they appear in a collapsed section labeled "Auto-Generated IDs (Read-Only)".

---

### 2. **Dynamic Parent Selection** âœ…

Parent dropdown is now **filtered based on entity type**:

#### For Organization
- **Parent field:** Disabled/Empty
- **Help text:** "Organizations do not require a parent"
- **Required:** No

#### For Branch
- **Parent field:** Shows only **Organizations** (active only)
- **Help text:** "Select an Organization as parent (REQUIRED for Branch)"
- **Required:** Yes

#### For Agent
- **Parent field:** Shows only **Branches** (active only)
- **Help text:** "Select a Branch as parent (REQUIRED for Agent)"
- **Required:** Yes

#### For Employee
- **Parent field:** Shows **Organizations, Branches, and Agents** (active only)
- **Help text:** "Select Organization, Branch, or Agent as parent (REQUIRED for Employee)"
- **Required:** Yes

---

### 3. **Auto-Generation Logic in Admin** âœ…

When saving a new entity in Django admin, the system automatically:

#### Organization
```
âœ… Generates: id = ORG-0001
âœ… Generates: organization_id = ORG-0001
```

#### Branch
```
âœ… Generates: id = BRN-0001
âœ… Generates: branch_id = BRN-0001
âœ… Inherits: organization_id from parent organization
```

#### Agent
```
âœ… Generates: id = AGT-0001
âœ… Inherits: branch_id from parent branch
âœ… Inherits: organization_id from parent's organization
```

#### Employee
```
âœ… Generates: id = EMP-0001
âœ… Inherits: branch_id from parent (if applicable)
âœ… Inherits: organization_id from parent
```

---

### 4. **Organized Fieldsets** âœ…

Admin form is now organized into collapsible sections:

1. **Basic Information**
   - Type
   - Parent (filtered based on type)
   - Name
   - Owner Name

2. **Contact Information**
   - Email
   - Contact Number
   - Address
   - City
   - Country

3. **Identification**
   - CNIC
   - CNIC Front (image upload)
   - CNIC Back (image upload)
   - Visiting Card (image upload)

4. **License & Tax** (collapsed)
   - DTS License
   - License Number
   - NTN Number

5. **Auto-Generated IDs (Read-Only)** (collapsed)
   - ID
   - Organization ID
   - Branch ID
   - âš ï¸ **Note:** These cannot be edited

6. **Status & Metadata** (collapsed)
   - Status
   - Is Active
   - Created By
   - Created At
   - Updated At

---

## ğŸ”„ Admin Workflow Examples

### Creating an Organization
```
1. Click "Add Universal Registration"
2. Select Type: "Organization"
3. Parent field: Disabled (not needed)
4. Fill in:
   - Name: "ABC Travel Agency"
   - Owner Name: "Muhammad Ali"
   - Email, Contact, Address, etc.
5. Click "Save"
6. âœ… System auto-generates:
   - ID: ORG-0001
   - Organization ID: ORG-0001
```

### Creating a Branch
```
1. Click "Add Universal Registration"
2. Select Type: "Branch"
3. Parent field: Dropdown shows only Organizations
   - Select: "ABC Travel Agency (ORG-0001)"
4. Fill in:
   - Name: "Lahore Branch"
   - Email, Contact, Address, etc.
5. Click "Save"
6. âœ… System auto-generates:
   - ID: BRN-0001
   - Branch ID: BRN-0001
   - Organization ID: ORG-0001 (inherited from parent)
```

### Creating an Agent
```
1. Click "Add Universal Registration"
2. Select Type: "Agent"
3. Parent field: Dropdown shows only Branches
   - Select: "Lahore Branch (BRN-0001)"
4. Fill in:
   - Name: "Ahmed Hassan"
   - Email, Contact, CNIC
   - Upload CNIC Front image
   - Upload CNIC Back image
   - Upload Visiting Card image
5. Click "Save"
6. âœ… System auto-generates:
   - ID: AGT-0001
   - Branch ID: BRN-0001 (inherited from parent)
   - Organization ID: ORG-0001 (inherited from parent's org)
```

### Creating an Employee
```
1. Click "Add Universal Registration"
2. Select Type: "Employee"
3. Parent field: Dropdown shows Organizations, Branches, and Agents
   - Select: "Lahore Branch (BRN-0001)"
4. Fill in:
   - Name: "Sara Malik"
   - Email, Contact, etc.
5. Click "Save"
6. âœ… System auto-generates:
   - ID: EMP-0001
   - Branch ID: BRN-0001 (inherited from parent)
   - Organization ID: ORG-0001 (inherited from parent)
```

---

## ğŸš« What's Blocked in Admin

### Cannot Input These Fields:
- âŒ `id` - Auto-generated by system
- âŒ `organization_id` - Auto-generated or inherited
- âŒ `branch_id` - Auto-generated or inherited
- âŒ `created_at` - Auto-set timestamp
- âŒ `updated_at` - Auto-set timestamp

### Cannot Select Wrong Parent Type:
- âŒ Branch cannot select Branch as parent (only Organization shown)
- âŒ Agent cannot select Organization as parent (only Branch shown)
- âŒ Agent cannot select Agent as parent (only Branch shown)

---

## ğŸ“‹ Admin List View

The admin list displays:
- ID
- Type
- Name
- Parent
- Status
- Is Active
- Organization ID
- Branch ID

**Search by:**
- ID
- Name
- Email
- Contact Number
- Organization ID
- Branch ID

**Filter by:**
- Type (Organization/Branch/Agent/Employee)
- Status (Active/Inactive/Suspended)
- Is Active (Yes/No)

---

## ğŸ¨ Visual Layout in Admin

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Add Universal Registration                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ â–¼ Basic Information                                 â”‚
â”‚   Type: [Agent â–¼]                                   â”‚
â”‚   Parent: [Lahore Branch (BRN-0001) â–¼] *REQUIRED*   â”‚
â”‚          Help: Select a Branch as parent            â”‚
â”‚   Name: [_____________________________]             â”‚
â”‚   Owner Name: [_________________________]           â”‚
â”‚                                                      â”‚
â”‚ â–¼ Contact Information                               â”‚
â”‚   Email: [_____________________________]            â”‚
â”‚   Contact No: [_______________________]             â”‚
â”‚   Address: [___________________________]            â”‚
â”‚   City: [______________________________]            â”‚
â”‚   Country: [Pakistan___________________]            â”‚
â”‚                                                      â”‚
â”‚ â–¼ Identification                                    â”‚
â”‚   CNIC: [_____________________________]             â”‚
â”‚   CNIC Front: [Choose File] (image upload)          â”‚
â”‚   CNIC Back: [Choose File] (image upload)           â”‚
â”‚   Visiting Card: [Choose File] (image upload)       â”‚
â”‚                                                      â”‚
â”‚ â–º License & Tax (collapsed)                         â”‚
â”‚                                                      â”‚
â”‚ â–º Auto-Generated IDs (Read-Only) (collapsed)        â”‚
â”‚   â„¹ï¸ These IDs are automatically generated           â”‚
â”‚   ID: ORG-0001 (cannot edit)                        â”‚
â”‚   Organization ID: ORG-0001 (cannot edit)           â”‚
â”‚   Branch ID: BRN-0001 (cannot edit)                 â”‚
â”‚                                                      â”‚
â”‚ â–º Status & Metadata (collapsed)                     â”‚
â”‚                                                      â”‚
â”‚ [Save and add another] [Save and continue] [Save]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Benefits

1. **Prevents Errors** - Users cannot input wrong IDs
2. **Clear Guidance** - Help text guides parent selection
3. **Smart Filtering** - Only valid parents shown
4. **Auto-Generation** - IDs created automatically
5. **Organized Layout** - Fieldsets group related fields
6. **Image Support** - Easy upload for CNIC and visiting cards

---

## ğŸ”§ Technical Implementation

### Files Modified:
- `universal/admin.py`

### Key Components:

1. **UniversalRegistrationAdminForm**
   - Custom form with dynamic parent filtering
   - Changes parent queryset based on selected type
   - Adds help text and required validation

2. **UniversalRegistrationAdmin**
   - Uses custom form
   - Sets readonly_fields for auto-generated IDs
   - Organizes fields into logical fieldsets
   - Overrides save_model() for auto-generation logic

3. **save_model() Override**
   - Generates primary ID using generate_prefixed_id()
   - Auto-generates organization_id for organizations
   - Auto-generates branch_id for branches
   - Inherits IDs for agents and employees
   - Sets created_by from current user

---

## ğŸ§ª Testing in Admin

### Test Case 1: Create Organization
1. Go to Django admin
2. Add Universal Registration
3. Type: Organization
4. Verify: Parent field is empty/disabled
5. Fill name and save
6. Verify: organization_id is auto-set

### Test Case 2: Create Branch
1. Add Universal Registration
2. Type: Branch
3. Verify: Parent dropdown shows ONLY organizations
4. Select an organization
5. Fill details and save
6. Verify: branch_id auto-generated, organization_id inherited

### Test Case 3: Create Agent
1. Add Universal Registration
2. Type: Agent
3. Verify: Parent dropdown shows ONLY branches
4. Select a branch
5. Upload CNIC and visiting card images
6. Save
7. Verify: Both IDs inherited correctly

### Test Case 4: Try to Edit IDs
1. Open existing registration
2. Scroll to "Auto-Generated IDs" section
3. Verify: All ID fields are grayed out (read-only)
4. Try to change - should not be editable

---

**Last Updated:** November 1, 2025
